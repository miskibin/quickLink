<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="quickLink.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:quickLink"
    xmlns:models="using:quickLink.Models"
    xmlns:converters="using:quickLink.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <DesktopAcrylicBackdrop/>
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid"
            Background="Transparent"
            KeyDown="OnRootKeyDown"
            Opacity="0">
        <Grid.Resources>
            <!-- Converters -->
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
            <converters:SafeImageConverter x:Key="SafeImageConverter"/>

            <!-- PowerToys-style animations -->
            <Storyboard x:Name="WindowEnterAnimation">
                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                 Storyboard.TargetProperty="Opacity"
                                 From="0"
                        To="1"
                                 Duration="0:0:0.2">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="ContentGrid"
                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                 From="0.95"
                        To="1"
                                 Duration="0:0:0.2">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="ContentGrid"
                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                 From="0.95"
                        To="1"
                                 Duration="0:0:0.2">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>
        </Grid.Resources>

        <!-- Modern semi-transparent background with darker tint for dark theme -->
        <Border Background="#20000000"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                Margin="0"
                CornerRadius="12">
            <Border.Shadow>
                <ThemeShadow/>
            </Border.Shadow>

            <Grid Margin="16"
                    x:Name="ContentGrid"
                    RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                    <ScaleTransform ScaleX="1"
                            ScaleY="1"/>
                </Grid.RenderTransform>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- PowerToys-style Search Box - integrated look with bottom border only -->
                <Grid Grid.Row="0"
                        Margin="0,0,0,12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBox x:Name="SearchBox"
                             Grid.Row="0"
                             PlaceholderText="Type to search..."
                             FontSize="16"
                             BorderThickness="0"
                             Background="Transparent"
                             Padding="4,8,4,8"
                             TextChanged="OnSearchTextChanged"
                             TabIndex="0">
                        <TextBox.Resources>
                            <!-- Remove focus visual and background changes -->
                            <SolidColorBrush x:Key="TextControlBackgroundFocused"
                                    Color="Transparent"/>
                            <SolidColorBrush x:Key="TextControlBackgroundPointerOver"
                                    Color="Transparent"/>
                            <SolidColorBrush x:Key="TextControlBorderBrushFocused"
                                    Color="Transparent"/>
                            <SolidColorBrush x:Key="TextControlBorderBrushPointerOver"
                                    Color="Transparent"/>
                            <Thickness x:Key="TextControlBorderThemeThicknessFocused">0</Thickness>
                        </TextBox.Resources>
                        <TextBox.KeyboardAccelerators>
                            <KeyboardAccelerator Key="Escape"
                                    Invoked="OnEscapePressed"/>
                            <KeyboardAccelerator Key="Enter"
                                    Invoked="OnEnterPressed"/>
                            <KeyboardAccelerator Key="Space"
                                    Modifiers="Control"
                                    Invoked="OnToggleVisibility"/>
                            <KeyboardAccelerator Key="Down"
                                    Invoked="OnDownArrow"/>
                            <KeyboardAccelerator Key="Up"
                                    Invoked="OnUpArrow"/>
                        </TextBox.KeyboardAccelerators>
                    </TextBox>
                </Grid>

                <!-- List View (hidden when editing) -->
                <ListView x:Name="ItemsList"
                          Grid.Row="1"
                          SelectionMode="Single"
                          IsItemClickEnabled="False"
                          CanReorderItems="False"
                          CanDragItems="False"
                          AllowDrop="False"
                          IsSwipeEnabled="False"
                          IncrementalLoadingTrigger="None"
                          Background="Transparent"
                          Padding="0"
                          MaxHeight="336"
                          Visibility="Visible">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Stretch"/>
                            <Setter Property="Padding"
                                    Value="0"/>
                            <Setter Property="Margin"
                                    Value="0,0,0,2"/>
                            <Setter Property="MinHeight"
                                    Value="0"/>
                            <Setter Property="CornerRadius"
                                    Value="6"/>
                            <Setter Property="Background"
                                    Value="Transparent"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Grid x:Name="Root"
                                              Background="{TemplateBinding Background}"
                                              CornerRadius="{TemplateBinding CornerRadius}">
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualStateGroup.Transitions>
                                                        <VisualTransition GeneratedDuration="0:0:0.15">
                                                            <VisualTransition.GeneratedEasingFunction>
                                                                <CubicEase EasingMode="EaseOut"/>
                                                            </VisualTransition.GeneratedEasingFunction>
                                                        </VisualTransition>
                                                    </VisualStateGroup.Transitions>
                                                    <VisualState x:Name="Normal">
                                                        <VisualState.Setters>
                                                            <Setter Target="SelectionIndicator.Opacity"
                                                                    Value="0"/>
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                    <VisualState x:Name="Selected">
                                                        <VisualState.Setters>
                                                            <Setter Target="Root.Background"
                                                                    Value="#20FFFFFF"/>
                                                            <Setter Target="SelectionIndicator.Opacity"
                                                                    Value="1"/>
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                    <VisualState x:Name="PointerOver">
                                                        <VisualState.Setters>
                                                            <Setter Target="Root.Background"
                                                                    Value="#15FFFFFF"/>
                                                            <Setter Target="SelectionIndicator.Opacity"
                                                                    Value="0"/>
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                    <VisualState x:Name="PointerOverSelected">
                                                        <VisualState.Setters>
                                                            <Setter Target="Root.Background"
                                                                    Value="#25FFFFFF"/>
                                                            <Setter Target="SelectionIndicator.Opacity"
                                                                    Value="1"/>
                                                        </VisualState.Setters>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>

                                            <!-- PowerToys-style selection indicator on the left -->
                                            <Rectangle x:Name="SelectionIndicator"
                                                       Width="3"
                                                       HorizontalAlignment="Left"
                                                       Fill="{ThemeResource AccentFillColorDefaultBrush}"
                                                       RadiusX="2"
                                                       RadiusY="2"
                                                       Opacity="0"
                                                       Margin="0,6,0,6"/>

                                            <ContentPresenter x:Name="ContentPresenter"
                                                              ContentTemplate="{TemplateBinding ContentTemplate}"
                                                              Content="{TemplateBinding Content}"
                                                              ContentTransitions="{TemplateBinding ContentTransitions}"
                                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                              Margin="8,0,0,0"/>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Background="Transparent"
                                  Padding="8,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Icon area - supports favicons, emoji, and glyph icons -->
                                <Grid Grid.Column="0"
                                      Width="28"
                                      Height="28"
                                      Margin="0,0,10,0"
                                      VerticalAlignment="Center">
                                    
                                    <!-- Favicon for LinkItems (highest priority) -->
                                    <Border Width="28"
                                            Height="28"
                                            CornerRadius="5"
                                            Background="#E0FFFFFF"
                                            Padding="1">
                                        <Border.Visibility>
                                            <Binding Path="HasFavicon" Mode="OneWay">
                                                <Binding.Converter>
                                                    <StaticResource ResourceKey="BoolToVisibilityConverter"/>
                                                </Binding.Converter>
                                            </Binding>
                                        </Border.Visibility>
                                        <Image Stretch="Uniform">
                                            <Image.Source>
                                                <Binding Path="FaviconUrl" Mode="OneWay">
                                                    <Binding.Converter>
                                                        <StaticResource ResourceKey="SafeImageConverter"/>
                                                    </Binding.Converter>
                                                </Binding>
                                            </Image.Source>
                                        </Image>
                                    </Border>
                                    
                                    <!-- Emoji icon for UserCommandResultItem and CommandSuggestionItem -->
                                    <TextBlock Text="{Binding EmojiIcon, Mode=OneWay}"
                                               FontSize="20"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center">
                                        <TextBlock.Visibility>
                                            <Binding Path="UseEmojiIcon" Mode="OneWay">
                                                <Binding.Converter>
                                                    <StaticResource ResourceKey="BoolToVisibilityConverter"/>
                                                </Binding.Converter>
                                            </Binding>
                                        </TextBlock.Visibility>
                                    </TextBlock>
                                    
                                    <!-- FontIcon fallback (shows when not using favicon or emoji) -->
                                    <FontIcon FontFamily="Segoe Fluent Icons"
                                              FontSize="24"
                                              Foreground="{Binding IconColor, Mode=OneWay}">
                                        <FontIcon.Visibility>
                                            <Binding Path="UseGlyphIcon" Mode="OneWay">
                                                <Binding.Converter>
                                                    <StaticResource ResourceKey="BoolToVisibilityConverter"/>
                                                </Binding.Converter>
                                            </Binding>
                                        </FontIcon.Visibility>
                                        <FontIcon.Glyph>
                                            <Binding Path="IconGlyph" Mode="OneWay"/>
                                        </FontIcon.Glyph>
                                    </FontIcon>
                                </Grid>

                                <StackPanel Grid.Column="1"
                                        Spacing="2"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayTitle, Mode=OneWay}"
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding DisplayValue, Mode=OneWay}"
                                               FontSize="11"
                                               TextTrimming="CharacterEllipsis"
                                               MaxLines="1"
                                               Opacity="0.7"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2"
                                            Orientation="Horizontal"
                                            Spacing="1"
                                            VerticalAlignment="Center">
                                    <StackPanel.Visibility>
                                        <Binding Path="ShowEditButton" Mode="OneWay">
                                            <Binding.Converter>
                                                <StaticResource ResourceKey="BoolToVisibilityConverter"/>
                                            </Binding.Converter>
                                        </Binding>
                                    </StackPanel.Visibility>
                                    <Button Width="26"
                                            Height="26"
                                            Padding="0"
                                            CornerRadius="4"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Click="OnEditClicked"
                                            Tag="{Binding}">
                                        <Button.Transitions>
                                            <TransitionCollection>
                                                <RepositionThemeTransition/>
                                            </TransitionCollection>
                                        </Button.Transitions>
                                        <FontIcon FontFamily="Segoe Fluent Icons"
                                                  Glyph="&#xE70F;"
                                                  FontSize="12"/>
                                    </Button>
                                    <Button Width="26"
                                            Height="26"
                                            Padding="0"
                                            CornerRadius="4"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Click="OnDeleteClicked"
                                            Tag="{Binding}">
                                        <Button.Visibility>
                                            <Binding Path="ShowDeleteButton" Mode="OneWay">
                                                <Binding.Converter>
                                                    <StaticResource ResourceKey="BoolToVisibilityConverter"/>
                                                </Binding.Converter>
                                            </Binding>
                                        </Button.Visibility>
                                        <Button.Transitions>
                                            <TransitionCollection>
                                                <RepositionThemeTransition/>
                                            </TransitionCollection>
                                        </Button.Transitions>
                                        <FontIcon FontFamily="Segoe Fluent Icons"
                                                  Glyph="&#xE74D;"
                                                  FontSize="12"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Enter"
                                Invoked="OnEnterPressed"/>
                        <KeyboardAccelerator Key="Escape"
                                Invoked="OnEscapePressed"/>
                    </ListView.KeyboardAccelerators>
                </ListView>

                <!-- Fixed Footer with Add New Item, Settings, and Exit buttons -->
                <Grid x:Name="FooterPanel"
                      Grid.Row="2"
                      Background="Transparent"
                      Margin="0,4,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Add New Item Button -->
                    <Button Grid.Column="0"
                            x:Name="AddNewButton"
                            Background="Transparent"
                            BorderThickness="0"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Left"
                            Padding="6,5"
                            CornerRadius="6"
                            Click="OnAddNewTapped"
                            TabIndex="1">
                        <StackPanel Orientation="Horizontal"
                                Spacing="8">
                            <FontIcon FontFamily="Segoe Fluent Icons"
                                      Glyph="&#xE710;"
                                      FontSize="16"
                                      Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                      VerticalAlignment="Center"/>
                            <TextBlock Text="Add new item"
                                       FontWeight="SemiBold"
                                       FontSize="13"
                                       Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Settings and Close Buttons -->
                    <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="3">
                        <Button x:Name="SettingsButton"
                                Background="Transparent"
                                BorderThickness="0"
                                Width="32"
                                Height="32"
                                Padding="0"
                                CornerRadius="6"
                                Click="OnSettingsClicked"
                                TabIndex="2"
                                ToolTipService.ToolTip="Settings">
                            <FontIcon FontFamily="Segoe Fluent Icons"
                                      Glyph="&#xE713;"
                                      FontSize="16"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </Button>

                        <Button x:Name="ExitButton"
                                Background="Transparent"
                                BorderThickness="0"
                                Width="32"
                                Height="32"
                                Padding="0"
                                CornerRadius="6"
                                Click="OnExitClicked"
                                TabIndex="3"
                                ToolTipService.ToolTip="Exit Application">
                            <FontIcon FontFamily="Segoe Fluent Icons"
                                      Glyph="&#xE711;"
                                      FontSize="16"
                                      Foreground="#C42B1C"/>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Inline Edit View -->
                <StackPanel x:Name="EditPanel"
                            Grid.Row="1"
                            Grid.RowSpan="2"
                            Spacing="10"
                            Visibility="Collapsed"
                            Background="Transparent">
                    <StackPanel.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Escape"
                                Invoked="OnCancelEditKey"/>
                    </StackPanel.KeyboardAccelerators>
                    <TextBox x:Name="EditTitle"
                             PlaceholderText="Title (optional)"
                             FontSize="13"
                             CornerRadius="6"
                             Background="{ThemeResource LayerFillColorDefaultBrush}"
                             BorderThickness="0"
                             Padding="10,8"
                             MaxLength="100"/>

                    <TextBox x:Name="EditValue"
                             PlaceholderText="Paste text or URL..."
                             FontSize="13"
                             CornerRadius="6"
                             Background="{ThemeResource LayerFillColorDefaultBrush}"
                             BorderThickness="0"
                             Padding="10,8"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             MinHeight="80"
                             MaxHeight="120"/>

                    <CheckBox x:Name="EditEncrypt"
                              Content="Encrypt"
                              FontSize="12"/>

                    <StackPanel Orientation="Horizontal"
                            Spacing="6"
                            HorizontalAlignment="Right">
                        <Button Content="Cancel"
                                Click="OnCancelEdit"
                                CornerRadius="6"
                                Padding="14,8"
                                FontSize="12"/>
                        <Button Content="Save"
                                Click="OnSaveEdit"
                                Style="{StaticResource AccentButtonStyle}"
                                CornerRadius="6"
                                Padding="14,8"
                                FontSize="12"/>
                    </StackPanel>
                </StackPanel>

                <!-- Inline Command Add/Edit View -->
                <ScrollViewer x:Name="CommandPanel"
                              Grid.Row="1"
                              Grid.RowSpan="2"
                              Visibility="Collapsed"
                              VerticalScrollBarVisibility="Auto"
                              Background="Transparent">
                    <StackPanel Spacing="16" Padding="0,0,0,10">
                        <StackPanel.KeyboardAccelerators>
                            <KeyboardAccelerator Key="Escape"
                                    Invoked="OnCancelCommandEditKey"/>
                        </StackPanel.KeyboardAccelerators>

                        <!-- Title -->
                        <TextBlock Text="Add New Command"
                                  FontWeight="SemiBold"
                                  FontSize="16"/>

                        <!-- BASICS GROUP -->
                        <StackPanel Spacing="8">
        
                            <!-- Command Prefix -->
                            <TextBox x:Name="CommandPrefix"
                                    PlaceholderText="/docs"
                                    FontSize="13"
                                    CornerRadius="6"
                                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                                    BorderThickness="0"
                                    Padding="10,8"
                                    MaxLength="50"
                                    Header="Command Prefix"
                                    Description="Type this prefix to trigger the command"/>

                            <!-- Source Type Picker (Compact) -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Source" FontSize="12" Opacity="0.8"/>
                                <ComboBox x:Name="CommandSourceCombo"
                                         FontSize="13"
                                         HorizontalAlignment="Stretch"
                                         SelectionChanged="OnCommandSourceTypeChanged">
                                    <ComboBoxItem Content="Directory" IsSelected="True" Tag="Directory"/>
                                    <ComboBoxItem Content="Static List" Tag="Static"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Directory Source (shown when Directory is selected) -->
                            <StackPanel x:Name="DirectoryConfigPanel" Spacing="6">
                                <!-- Source Folder -->
                                <TextBox x:Name="CommandPath"
                                        PlaceholderText="C:\Users\Michal\Documents"
                                        FontSize="13"
                                        CornerRadius="6"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                                        BorderThickness="0"
                                        Padding="10,8"
                                        Header="Source Folder"/>
                                
                                <!-- Advanced Settings Expander -->
                                <Expander HorizontalAlignment="Stretch"
                                         HorizontalContentAlignment="Stretch"
                                         IsExpanded="False">
                                    <Expander.Header>
                                        <TextBlock Text="Advanced settings" FontSize="11" Opacity="0.7"/>
                                    </Expander.Header>
                                    <StackPanel Spacing="8" Padding="0,8,0,0">
                                        <!-- File Pattern -->
                                        <TextBox x:Name="CommandGlob"
                                                PlaceholderText="*.*"
                                                FontSize="12"
                                                CornerRadius="4"
                                                Padding="8,6"
                                                Header="File Pattern (glob)"
                                                Description="Examples: *.md, *.txt, *.pdf"/>
                                        
                                        <!-- Recursive Checkbox -->
                                        <CheckBox x:Name="CommandRecursive"
                                                 Content="Search in subdirectories"
                                                 IsChecked="True"
                                                 FontSize="12"/>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>

                            <!-- Static Items Configuration (shown when Static is selected) -->
                            <StackPanel x:Name="StaticItemsConfigPanel"
                                       Spacing="6"
                                       Visibility="Collapsed">
                                <!-- Items List -->
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Items" FontSize="12" Opacity="0.8"/>
                                    <ListBox x:Name="StaticItemsList"
                                            MinHeight="80"
                                            MaxHeight="160"
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Padding="4"
                                            FontSize="12"/>
                                </StackPanel>

                                <!-- Add/Remove Item -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="NewStaticItemTextBox"
                                            Grid.Column="0"
                                            PlaceholderText="Add item..."
                                            FontSize="12"
                                            CornerRadius="4"
                                            Padding="8,6"
                                            Margin="0,0,6,0"
                                            KeyDown="OnStaticItemTextBoxKeyDown"/>
                                    <Button Grid.Column="1"
                                           Content="Add"
                                           Click="OnAddStaticItem"
                                           CornerRadius="4"
                                           Padding="12,6"
                                           FontSize="12"
                                           Margin="0,0,6,0"/>
                                    <Button Grid.Column="2"
                                           Content="Remove"
                                           Click="OnRemoveStaticItem"
                                           CornerRadius="4"
                                           Padding="12,6"
                                           FontSize="12"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>

                        <!-- ACTION GROUP -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Action"
                                      FontWeight="SemiBold"
                                      FontSize="13"
                                      Opacity="0.9"
                                      Margin="0,0,0,4"/>
                            
                            <StackPanel Spacing="4">
                                <TextBlock Text="When I select an item, run:" 
                                          FontSize="12"
                                          Opacity="0.8"/>
                                <TextBox x:Name="CommandExecuteTemplate"
                                        PlaceholderText='Example: code "{item.path}"'
                                        FontSize="13"
                                        CornerRadius="6"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                                        BorderThickness="0"
                                        Padding="10,8"
                                        TextWrapping="Wrap"
                                        MinHeight="56"/>
                                
                                <!-- Hint examples (compact, inline) -->
                                <TextBlock FontSize="10" Opacity="0.5" TextWrapping="Wrap">
                                    <Run Text="Examples:"/>
                                    <LineBreak/>
                                    <Run Text='notepad "{item.path}"'/>
                                    <Run Text=" â€¢ "/>
                                    <Run Text='code "{item.path}"'/>
                                    <Run Text=" â€¢ "/>
                                    <Run Text='explorer /select,"{item.path}"'/>
                                </TextBlock>

                                <!-- Live Preview -->
                                <Border x:Name="CommandPreviewBorder"
                                       Background="#10FFFFFF"
                                       BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                       BorderThickness="1"
                                       CornerRadius="4"
                                       Padding="8,6"
                                       Margin="0,4,0,0">
                                    <StackPanel Spacing="2">
                                        <TextBlock Text="Preview:" FontSize="10" Opacity="0.6"/>
                                        <TextBlock x:Name="CommandPreviewText"
                                                  Text='notepad "C:\Users\Michal\Documents\example.md"'
                                                  FontSize="11"
                                                  FontFamily="Consolas"
                                                  Opacity="0.8"
                                                  TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <!-- DISPLAY GROUP -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Display"
                                      FontWeight="SemiBold"
                                      FontSize="13"
                                      Opacity="0.9"
                                      Margin="0,0,0,4"/>
                            
                            <!-- Icon Picker (Visual buttons) -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Icon" FontSize="12" Opacity="0.8"/>
                                <ComboBox x:Name="CommandIconCombo"
                                         FontSize="13"
                                         HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="ðŸ“ Folder" IsSelected="True" Tag="Folder"/>
                                    <ComboBoxItem Content="ðŸŒ Web" Tag="Web"/>
                                    <ComboBoxItem Content="âš™ï¸ Script" Tag="Script"/>
                                    <ComboBoxItem Content="ðŸ“„ Document" Tag="Document"/>
                                </ComboBox>
                            </StackPanel>
                            
                            <!-- Terminal Checkbox -->
                            <CheckBox x:Name="CommandOpenInTerminal"
                                     Content="Run in terminal window"
                                     FontSize="12"/>
                        </StackPanel>

                        <!-- Buttons -->
                        <StackPanel Orientation="Horizontal"
                                Spacing="6"
                                HorizontalAlignment="Right"
                                Margin="0,8,0,0">
                            <Button Content="Cancel"
                                    Click="OnCancelCommandEdit"
                                    CornerRadius="6"
                                    Padding="14,8"
                                    FontSize="12"/>
                            <Button Content="Save"
                                    Click="OnSaveCommandEdit"
                                    Style="{StaticResource AccentButtonStyle}"
                                    CornerRadius="6"
                                    Padding="14,8"
                                    FontSize="12"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Settings View -->
                <ScrollViewer x:Name="SettingsPanel"
                              Grid.Row="1"
                              Grid.RowSpan="2"
                              Visibility="Collapsed"
                              VerticalScrollBarVisibility="Auto"
                              Padding="0,0,0,0">
                    <StackPanel Spacing="16"
                            Background="Transparent">
                        <StackPanel.KeyboardAccelerators>
                            <KeyboardAccelerator Key="Escape"
                                    Invoked="OnCloseSettingsKey"/>
                        </StackPanel.KeyboardAccelerators>

                        <!-- Checkboxes -->
                        <CheckBox x:Name="StartWithSystemCheckBox"
                                  Content="Launch on system startup"
                                  FontSize="13"
                                  Checked="OnStartWithSystemChanged"
                                  Unchecked="OnStartWithSystemChanged"
                                  TabIndex="10"/>

                        <CheckBox x:Name="HideFooterCheckBox"
                                  Content="Hide footer (make Add/Settings/Exit searchable)"
                                  FontSize="13"
                                  Checked="OnHideFooterChanged"
                                  Unchecked="OnHideFooterChanged"
                                  TabIndex="11"/>

                        <!-- Search URL -->
                        <StackPanel Spacing="6">
                            <TextBlock Text="Search URL (use {query} as placeholder)"
                                       FontSize="12"
                                       Opacity="0.7"/>

                            <TextBox x:Name="SearchUrlTextBox"
                                     PlaceholderText="https://chatgpt.com/?q={query}"
                                     FontSize="13"
                                     CornerRadius="6"
                                     Background="{ThemeResource LayerFillColorDefaultBrush}"
                                     BorderThickness="1"
                                     BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                     Padding="10,8"
                                     TextChanged="OnSearchUrlChanged"
                                     TabIndex="12"/>
                        </StackPanel>

                        <!-- Hotkey -->
                        <StackPanel Spacing="6">
                            <TextBlock Text="Click and press a key combination"
                                       FontSize="12"
                                       Opacity="0.7"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBox x:Name="HotkeyTextBox"
                                         Grid.Column="0"
                                         PlaceholderText="Press keys..."
                                         FontSize="13"
                                         CornerRadius="6"
                                         Background="{ThemeResource LayerFillColorDefaultBrush}"
                                         BorderThickness="1"
                                         BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                         Padding="10,8"
                                         IsReadOnly="True"
                                         PreviewKeyDown="OnHotkeyKeyDown"
                                         LostFocus="OnHotkeyTextBoxLostFocus"
                                         Margin="0,0,8,0"
                                         TabIndex="13"/>

                                <Button x:Name="ApplyHotkeyButton"
                                        Grid.Column="1"
                                        Content="Apply"
                                        Click="OnApplyHotkey"
                                        CornerRadius="6"
                                        Padding="16,8"
                                        FontSize="12"
                                        IsEnabled="False"
                                        Margin="0,0,8,0"
                                        TabIndex="14"
                                        Style="{ThemeResource AccentButtonStyle}"/>

                                <Button Grid.Column="2"
                                        Content="Reset"
                                        Click="OnResetHotkey"
                                        CornerRadius="6"
                                        Padding="16,8"
                                        FontSize="12"
                                        TabIndex="15"/>
                            </Grid>

                            <TextBlock x:Name="HotkeyStatusText"
                                       FontSize="11"
                                       Opacity="0.5"
                                       TextWrapping="Wrap"
                                       Text="Must include modifier (Ctrl, Shift, or Alt) + key"/>
                        </StackPanel>

                        <!-- Close Button -->
                        <Button Content="Close"
                                Click="OnCloseSettings"
                                CornerRadius="6"
                                Padding="20,10"
                                FontSize="13"
                                HorizontalAlignment="Right"
                                TabIndex="16"
                                Style="{ThemeResource AccentButtonStyle}"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- Minimal Loading Indicator -->
                <Grid x:Name="LoadingOverlay"
                      Grid.RowSpan="2"
                      Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                      Visibility="Collapsed">
                    <ProgressRing IsActive="True"
                            Width="40"
                            Height="40"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
